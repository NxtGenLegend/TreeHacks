<!doctype html>
<html>
    <head>
        <title>Video Meeting</title>
        <link rel="stylesheet" href="/css/styles.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    </head>
    <body>
        <div class="container">
            <div class="main-content">
                <div class="meeting-header">
                    <h2 class="meeting-title">Video Meeting</h2>
                </div>

                <div class="form-group">
                    <div class="url-container">
                        <label>Meeting URL:</label>
                        <input type="text" id="webhookUrl" placeholder="Enter meeting URL" />
                        <button id="validateBtn">
                            <i class="fas fa-check-circle"></i> Validate
                        </button>
                    </div>
                </div>

                <div class="video-container">
                    <video id="mediaVideo" autoplay playsinline muted></video>
                    <audio id="mediaAudio" autoplay></audio>
                </div>

                <div class="controls">
                    <button id="sendBtn" disabled>
                        <i class="fas fa-video"></i> Start Meeting
                    </button>
                    <button id="pauseBtn" disabled>
                        <i class="fas fa-pause"></i> Pause
                    </button>
                    <button id="resumeBtn" disabled>
                        <i class="fas fa-play"></i> Resume
                    </button>
                    <button id="stopBtn" disabled>
                        <i class="fas fa-stop"></i> Stop
                    </button>
                    <button id="endBtn" disabled>
                        <i class="fas fa-phone-slash"></i> End Meeting
                    </button>
                </div>
            </div>

            <div class="sidebar">
                <div class="log-tabs">
                    <button class="tab-button active" data-tab="transcripts">Transcripts</button>
                    <button class="tab-button" data-tab="events">Events</button>
                </div>

                <div id="transcripts-container" class="logs-container">
                    <div id="transcript"></div>
                </div>

                <div id="events-container" class="logs-container" style="display: none;">
                    <div id="response"></div>
                </div>
            </div>
        </div>

        <!-- Configuration -->
        <script src="/js/config.js"></script>
        
        <!-- API Handler -->
        <script src="/js/api.js"></script>
        
        <!-- Core functionality -->
        <script src="/js/mediaHandler.js"></script>
        <script src="/js/webSocket.js"></script>
        
        <!-- UI and Controls -->
        <script src="/js/uiController.js"></script>

        <!-- Audio Processing -->
        <script src="/js/audio-processor.js"></script>

        <script>
            // Handle tabs
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    // Update active tab
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    // Show/hide containers
                    const tabName = button.dataset.tab;
                    document.getElementById('transcripts-container').style.display = 
                        tabName === 'transcripts' ? 'block' : 'none';
                    document.getElementById('events-container').style.display = 
                        tabName === 'events' ? 'block' : 'none';
                });
            });

            // Function to add transcript
            function addTranscript(text) {
                const transcriptDiv = document.getElementById('transcript');
                const entry = document.createElement('div');
                entry.className = 'transcript-entry';
                
                const timestamp = document.createElement('div');
                timestamp.className = 'transcript-timestamp';
                timestamp.textContent = new Date().toLocaleTimeString();
                
                const content = document.createElement('div');
                content.textContent = text;
                
                entry.appendChild(timestamp);
                entry.appendChild(content);
                transcriptDiv.appendChild(entry);
            }

            // Function to add event log
            function addEventLog(type, data) {
                const responseDiv = document.getElementById('response');
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                
                const header = document.createElement('div');
                header.className = 'log-header';
                header.innerHTML = `
                    <span>${type}</span>
                    <span class="log-timestamp">${new Date().toLocaleTimeString()}</span>
                `;
                
                const content = document.createElement('div');
                content.className = 'log-content';
                content.textContent = JSON.stringify(data, null, 2);
                
                header.addEventListener('click', () => {
                    content.classList.toggle('expanded');
                });
                
                entry.appendChild(header);
                entry.appendChild(content);
                responseDiv.appendChild(entry);
            }
        </script>
    </body>
</html>